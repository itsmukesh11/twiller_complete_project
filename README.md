# Twiller - Internship Project (Ready-to-run)

This repository contains a complete Twiller (Twitter-like) project with frontend (React) and backend (Node/Express + MongoDB). It implements the internship assignments:
- Browser notifications for tweets containing 'cricket' or 'science'
- Posting limits & schedule rules based on follow count
- Audio tweet recording + OTP email verification + upload (size & time window checks)
- Forgot password (1-per-day) with autogenerated password (only upper/lower letters)
- Subscriptions with Stripe (payments allowed only 10-11 AM IST) and invoice emails
- Custom video player with gesture controls (double/single/triple taps)

## Structure
- `backend/` - Express API
- `frontend/` - React app (simple CRA-like structure)

## Setup
1. Backend:
   - `cd backend`
   - `npm install`
   - create `.env` (one is provided)
   - `npm run dev`

2. Frontend:
   - `cd frontend`
   - `npm install`
   - create `.env.local` with `REACT_APP_API_URL=http://localhost:5000/api`
   - `npm start`

## Notes
- For production use: configure Stripe webhook verification, store files in cloud storage, and secure environment variables.
- Audio duration server-side validation requires ffmpeg + `fluent-ffmpeg`.
- The UI is minimal and styled to resemble Twitter's clean layout.

## Deployment (quick guide)

Frontend (Netlify / Vercel)
- Build the app: `npm run build` in `frontend`.
- Deploy the `frontend/build` (Netlify) or point Vercel to the frontend folder and set `REACT_APP_API_URL` to your backend API URL.

Backend (Render / Heroku)
- Ensure you set environment variables: `MONGO_URI`, `JWT_SECRET`, `SMTP_*`, `STRIPE_SECRET_KEY`, and optional `STRIPE_WEBHOOK_SECRET`.
- Install ffmpeg on the host (Render and Heroku have buildpacks or packages for ffmpeg). Fluent-ffmpeg requires ffprobe on PATH.
- Deploy the backend and expose `/api` endpoints.

Stripe webhook
- Register your webhook endpoint (e.g., `https://your-backend.example.com/api/payments/webhook`) in Stripe dashboard.
- Save the webhook signing secret in `STRIPE_WEBHOOK_SECRET` to enable signature verification.

Files & storage
- For production use, replace local `/uploads` storage with S3 or cloud storage and update the upload middleware.

Support
- If you need help with hosting steps, tell me the provider (Netlify/Render/Heroku/Vercel) and I will provide exact commands and environment variables to set.

## Email, ffprobe and Stripe setup (local testing)

### Mailtrap (recommended for local SMTP testing)

1. Create a free Mailtrap account at https://mailtrap.io
2. Create an Inbox and copy the SMTP credentials (host, port, user, pass).
3. Copy `.env.sample` to `.env` in the repo root and fill the `SMTP_HOST`, `SMTP_PORT`, `SMTP_USER`, `SMTP_PASS` values.
4. Restart the backend.

### Test sending an email

From the repo root run:

```powershell
cd backend
node scripts/test_email.js you@example.com
```

Check Mailtrap inbox for the test message. If the script complains about missing SMTP, ensure `.env` has the SMTP values and the backend is restarted.

### ffprobe (audio validation)

Server-side audio duration checks rely on `ffprobe` from the ffmpeg suite. On Windows you can install ffmpeg and add it to PATH, or set `FFPROBE_PATH` in `.env`.

To quickly check ffprobe availability run:

```powershell
cd backend
node scripts/check_ffprobe.js
```

If ffprobe is missing, install ffmpeg and ensure `ffprobe` is on PATH.

### Stripe (local simulation)

- The project contains a local simulation endpoint `POST /api/payments/confirm` used by `scripts/simulate_stripe_confirm.js` to test subscription flows without real Stripe webhooks. For live checkout testing you must set `STRIPE_SECRET_KEY` and configure webhooks in Stripe dashboard.

## Quick verification checklist

- Configure `.env` with `SMTP_` values (Mailtrap) and restart backend.
- Run `node backend/scripts/test_email.js you@example.com` and confirm message appears in Mailtrap.
- Run `node backend/scripts/check_ffprobe.js` to confirm ffprobe presence.
- Simulate a subscription by running `node backend/scripts/simulate_stripe_confirm.js` and check backend logs and Mailtrap for invoice email attempts.


