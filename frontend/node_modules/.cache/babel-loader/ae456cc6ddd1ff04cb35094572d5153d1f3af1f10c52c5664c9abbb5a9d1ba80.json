{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import API from\"./api\";import Sidebar from\"./layout/Sidebar\";import RightPanel from\"./layout/RightPanel\";import AuthForm from\"./components/AuthForm\";import{BrowserRouter,Routes,Route}from\"react-router-dom\";import Home from\"./pages/Home\";import Explore from\"./pages/Explore\";import Notifications from\"./pages/Notifications\";import Messages from\"./pages/Messages\";import Profile from\"./pages/Profile\";import NotificationContext from\"./notificationContext\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function App(){const[tweets,setTweets]=useState([]);const[notificationsEnabled,setNotificationsEnabled]=useState(()=>{const saved=localStorage.getItem(\"notificationsEnabled\");return saved===null?true:saved===\"true\";});const[user,setUser]=useState(()=>{const u=localStorage.getItem(\"user\");return u?JSON.parse(u):null;});// Google OAuth: capture JWT from URL and store in localStorage\n// On mount: check for token in URL or localStorage, fetch user info\nuseEffect(()=>{const params=new URLSearchParams(window.location.search);let token=params.get(\"token\");if(token){localStorage.setItem(\"token\",token);window.history.replaceState({},document.title,window.location.pathname);}else{token=localStorage.getItem(\"token\");}if(token&&!user){fetchUserFromToken(token);}},[]);async function fetchUserFromToken(token){try{// Always get token from localStorage if not provided\nif(!token){token=localStorage.getItem(\"token\");}console.log(\"Sending token to /auth/me:\",token);if(!token){console.warn(\"No token found in localStorage. User not authenticated.\");setUser(null);localStorage.removeItem(\"user\");localStorage.removeItem(\"token\");return;}const res=await API.get(\"/auth/me\",{headers:{Authorization:\"Bearer \".concat(token)}});if(res.data&&res.data.user){setUser(res.data.user);localStorage.setItem(\"user\",JSON.stringify(res.data.user));}}catch(err){console.error(\"/auth/me 401 error. Token used:\",token,err);setUser(null);localStorage.removeItem(\"user\");localStorage.removeItem(\"token\");}}useEffect(()=>{if(user)fetchTweets();},[user]);async function fetchTweets(){const res=await API.get(\"/tweets\");setTweets(res.data);}useEffect(()=>{if(!notificationsEnabled||!(\"Notification\"in window))return;tweets.forEach(t=>{if(!t._notified&&t.text&&/(cricket|science)/i.test(t.text)){if(Notification.permission===\"granted\"){new Notification(\"New Tweet\",{body:t.text});t._notified=true;}}});},[tweets,notificationsEnabled]);function handleAuth(u){setUser(u);localStorage.setItem(\"user\",JSON.stringify(u));}function handleLogout(){setUser(null);localStorage.removeItem(\"user\");localStorage.removeItem(\"token\");}if(!user){return/*#__PURE__*/_jsx(AuthForm,{onAuth:handleAuth});}return/*#__PURE__*/_jsx(NotificationContext.Provider,{value:{enabled:notificationsEnabled,setEnabled:v=>{setNotificationsEnabled(v);localStorage.setItem(\"notificationsEnabled\",v?\"true\":\"false\");}},children:/*#__PURE__*/_jsxs(BrowserRouter,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"navbar\",children:\"Twiller\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"app\",children:[/*#__PURE__*/_jsx(Sidebar,{user:user,onLogout:handleLogout}),/*#__PURE__*/_jsx(\"main\",{className:\"flex-1\",children:/*#__PURE__*/_jsxs(Routes,{children:[/*#__PURE__*/_jsx(Route,{path:\"/\",element:/*#__PURE__*/_jsx(Home,{})}),/*#__PURE__*/_jsx(Route,{path:\"/explore\",element:/*#__PURE__*/_jsx(Explore,{})}),/*#__PURE__*/_jsx(Route,{path:\"/notifications\",element:/*#__PURE__*/_jsx(Notifications,{})}),/*#__PURE__*/_jsx(Route,{path:\"/messages\",element:/*#__PURE__*/_jsx(Messages,{})}),/*#__PURE__*/_jsx(Route,{path:\"/profile\",element:/*#__PURE__*/_jsx(Profile,{})})]})}),/*#__PURE__*/_jsx(RightPanel,{})]})]})});}","map":{"version":3,"names":["React","useEffect","useState","API","Sidebar","RightPanel","AuthForm","BrowserRouter","Routes","Route","Home","Explore","Notifications","Messages","Profile","NotificationContext","jsx","_jsx","jsxs","_jsxs","App","tweets","setTweets","notificationsEnabled","setNotificationsEnabled","saved","localStorage","getItem","user","setUser","u","JSON","parse","params","URLSearchParams","window","location","search","token","get","setItem","history","replaceState","document","title","pathname","fetchUserFromToken","console","log","warn","removeItem","res","headers","Authorization","concat","data","stringify","err","error","fetchTweets","forEach","t","_notified","text","test","Notification","permission","body","handleAuth","handleLogout","onAuth","Provider","value","enabled","setEnabled","v","children","className","onLogout","path","element"],"sources":["C:/Users/itsmu/twiller_complete_project/frontend/src/App.js"],"sourcesContent":["\r\n\r\nimport React, { useEffect, useState } from \"react\";\r\nimport API from \"./api\";\r\nimport Sidebar from \"./layout/Sidebar\";\r\nimport RightPanel from \"./layout/RightPanel\";\r\nimport AuthForm from \"./components/AuthForm\";\r\nimport { BrowserRouter, Routes, Route } from \"react-router-dom\";\r\nimport Home from \"./pages/Home\";\r\nimport Explore from \"./pages/Explore\";\r\nimport Notifications from \"./pages/Notifications\";\r\nimport Messages from \"./pages/Messages\";\r\nimport Profile from \"./pages/Profile\";\r\nimport NotificationContext from \"./notificationContext\";\r\n\r\n\r\nexport default function App() {\r\n  const [tweets, setTweets] = useState([]);\r\n  const [notificationsEnabled, setNotificationsEnabled] = useState(() => {\r\n    const saved = localStorage.getItem(\"notificationsEnabled\");\r\n    return saved === null ? true : saved === \"true\";\r\n  });\r\n  const [user, setUser] = useState(() => {\r\n    const u = localStorage.getItem(\"user\");\r\n    return u ? JSON.parse(u) : null;\r\n  });\r\n\r\n  // Google OAuth: capture JWT from URL and store in localStorage\r\n\r\n  // On mount: check for token in URL or localStorage, fetch user info\r\n  useEffect(() => {\r\n    const params = new URLSearchParams(window.location.search);\r\n    let token = params.get(\"token\");\r\n    if (token) {\r\n      localStorage.setItem(\"token\", token);\r\n      window.history.replaceState({}, document.title, window.location.pathname);\r\n    } else {\r\n      token = localStorage.getItem(\"token\");\r\n    }\r\n    if (token && !user) {\r\n      fetchUserFromToken(token);\r\n    }\r\n  }, []);\r\n\r\n  async function fetchUserFromToken(token) {\r\n    try {\r\n      // Always get token from localStorage if not provided\r\n      if (!token) {\r\n        token = localStorage.getItem(\"token\");\r\n      }\r\n      console.log(\"Sending token to /auth/me:\", token);\r\n      if (!token) {\r\n        console.warn(\"No token found in localStorage. User not authenticated.\");\r\n        setUser(null);\r\n        localStorage.removeItem(\"user\");\r\n        localStorage.removeItem(\"token\");\r\n        return;\r\n      }\r\n      const res = await API.get(\"/auth/me\", {\r\n        headers: { Authorization: `Bearer ${token}` }\r\n      });\r\n      if (res.data && res.data.user) {\r\n        setUser(res.data.user);\r\n        localStorage.setItem(\"user\", JSON.stringify(res.data.user));\r\n      }\r\n    } catch (err) {\r\n      console.error(\"/auth/me 401 error. Token used:\", token, err);\r\n      setUser(null);\r\n      localStorage.removeItem(\"user\");\r\n      localStorage.removeItem(\"token\");\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (user) fetchTweets();\r\n  }, [user]);\r\n\r\n\r\n  async function fetchTweets() {\r\n  const res = await API.get(\"/tweets\");\r\n  setTweets(res.data);\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (!notificationsEnabled || !(\"Notification\" in window)) return;\r\n    tweets.forEach(t => {\r\n      if (!t._notified && t.text && /(cricket|science)/i.test(t.text)) {\r\n        if (Notification.permission === \"granted\") {\r\n          new Notification(\"New Tweet\", { body: t.text });\r\n          t._notified = true;\r\n        }\r\n      }\r\n    });\r\n  }, [tweets, notificationsEnabled]);\r\n\r\n  function handleAuth(u) {\r\n  setUser(u);\r\n  localStorage.setItem(\"user\", JSON.stringify(u));\r\n  }\r\n\r\n  function handleLogout() {\r\n  setUser(null);\r\n  localStorage.removeItem(\"user\");\r\n  localStorage.removeItem(\"token\");\r\n  }\r\n\r\n  if (!user) {\r\n    return <AuthForm onAuth={handleAuth} />;\r\n  }\r\n\r\n  return (\r\n    <NotificationContext.Provider value={{ enabled: notificationsEnabled, setEnabled: (v) => { setNotificationsEnabled(v); localStorage.setItem(\"notificationsEnabled\", v ? \"true\" : \"false\"); } }}>\r\n      <BrowserRouter>\r\n        {/* Top nav */}\r\n        <div className=\"navbar\">Twiller</div>\r\n        {/* Central app container */}\r\n        <div className=\"app\">\r\n          <Sidebar user={user} onLogout={handleLogout} />\r\n          <main className=\"flex-1\">\r\n            <Routes>\r\n              <Route path=\"/\" element={<Home />} />\r\n              <Route path=\"/explore\" element={<Explore />} />\r\n              <Route path=\"/notifications\" element={<Notifications />} />\r\n              <Route path=\"/messages\" element={<Messages />} />\r\n              <Route path=\"/profile\" element={<Profile />} />\r\n            </Routes>\r\n          </main>\r\n          <RightPanel />\r\n        </div>\r\n      </BrowserRouter>\r\n    </NotificationContext.Provider>\r\n  );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}