{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import API from\"./api\";import Sidebar from\"./layout/Sidebar\";import RightPanel from\"./layout/RightPanel\";import AuthForm from\"./components/AuthForm\";import{BrowserRouter,Routes,Route}from\"react-router-dom\";import Home from\"./pages/Home\";import Explore from\"./pages/Explore\";import Notifications from\"./pages/Notifications\";import Messages from\"./pages/Messages\";import Profile from\"./pages/Profile\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function App(){const[tweets,setTweets]=useState([]);const[notificationsEnabled]=useState(()=>{const saved=localStorage.getItem(\"notificationsEnabled\");return saved===null?true:saved===\"true\";});const[user,setUser]=useState(()=>{const u=localStorage.getItem(\"user\");return u?JSON.parse(u):null;});// Google OAuth: capture JWT from URL and store in localStorage\n// On mount: check for token in URL or localStorage, fetch user info\nuseEffect(()=>{const params=new URLSearchParams(window.location.search);let token=params.get(\"token\");if(token){localStorage.setItem(\"token\",token);window.history.replaceState({},document.title,window.location.pathname);}else{token=localStorage.getItem(\"token\");}if(token&&!user){fetchUserFromToken(token);}},[]);async function fetchUserFromToken(token){try{// Always get token from localStorage if not provided\nif(!token){token=localStorage.getItem(\"token\");}console.log(\"Sending token to /auth/me:\",token);if(!token){console.warn(\"No token found in localStorage. User not authenticated.\");setUser(null);localStorage.removeItem(\"user\");localStorage.removeItem(\"token\");return;}const res=await API.get(\"/auth/me\",{headers:{Authorization:\"Bearer \".concat(token)}});if(res.data&&res.data.user){setUser(res.data.user);localStorage.setItem(\"user\",JSON.stringify(res.data.user));}}catch(err){console.error(\"/auth/me 401 error. Token used:\",token,err);setUser(null);localStorage.removeItem(\"user\");localStorage.removeItem(\"token\");}}useEffect(()=>{if(user)fetchTweets();},[user]);async function fetchTweets(){const res=await API.get(\"/tweets\");setTweets(res.data);}useEffect(()=>{if(!notificationsEnabled||!(\"Notification\"in window))return;tweets.forEach(t=>{if(!t._notified&&t.text&&/(cricket|science)/i.test(t.text)){if(Notification.permission===\"granted\"){new Notification(\"New Tweet\",{body:t.text});t._notified=true;}}});},[tweets,notificationsEnabled]);function handleAuth(u){setUser(u);localStorage.setItem(\"user\",JSON.stringify(u));}function handleLogout(){setUser(null);localStorage.removeItem(\"user\");localStorage.removeItem(\"token\");}if(!user){return/*#__PURE__*/_jsx(AuthForm,{onAuth:handleAuth});}return/*#__PURE__*/_jsx(BrowserRouter,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex min-h-screen bg-gray-50 font-inter\",children:[/*#__PURE__*/_jsx(Sidebar,{user:user,onLogout:handleLogout}),/*#__PURE__*/_jsx(\"main\",{className:\"flex-1 flex flex-col items-center border-x border-gray-200\",children:/*#__PURE__*/_jsxs(Routes,{children:[/*#__PURE__*/_jsx(Route,{path:\"/\",element:/*#__PURE__*/_jsx(Home,{})}),/*#__PURE__*/_jsx(Route,{path:\"/explore\",element:/*#__PURE__*/_jsx(Explore,{})}),/*#__PURE__*/_jsx(Route,{path:\"/notifications\",element:/*#__PURE__*/_jsx(Notifications,{})}),/*#__PURE__*/_jsx(Route,{path:\"/messages\",element:/*#__PURE__*/_jsx(Messages,{})}),/*#__PURE__*/_jsx(Route,{path:\"/profile\",element:/*#__PURE__*/_jsx(Profile,{})})]})}),/*#__PURE__*/_jsx(RightPanel,{})]})});}","map":{"version":3,"names":["React","useEffect","useState","API","Sidebar","RightPanel","AuthForm","BrowserRouter","Routes","Route","Home","Explore","Notifications","Messages","Profile","jsx","_jsx","jsxs","_jsxs","App","tweets","setTweets","notificationsEnabled","saved","localStorage","getItem","user","setUser","u","JSON","parse","params","URLSearchParams","window","location","search","token","get","setItem","history","replaceState","document","title","pathname","fetchUserFromToken","console","log","warn","removeItem","res","headers","Authorization","concat","data","stringify","err","error","fetchTweets","forEach","t","_notified","text","test","Notification","permission","body","handleAuth","handleLogout","onAuth","children","className","onLogout","path","element"],"sources":["C:/Users/itsmu/Downloads/twiller_complete_project/frontend/src/App.js"],"sourcesContent":["\n\nimport React, { useEffect, useState } from \"react\";\nimport API from \"./api\";\nimport Sidebar from \"./layout/Sidebar\";\nimport RightPanel from \"./layout/RightPanel\";\nimport AuthForm from \"./components/AuthForm\";\nimport { BrowserRouter, Routes, Route } from \"react-router-dom\";\nimport Home from \"./pages/Home\";\nimport Explore from \"./pages/Explore\";\nimport Notifications from \"./pages/Notifications\";\nimport Messages from \"./pages/Messages\";\nimport Profile from \"./pages/Profile\";\n\n\nexport default function App() {\n  const [tweets, setTweets] = useState([]);\n  const [notificationsEnabled] = useState(() => {\n    const saved = localStorage.getItem(\"notificationsEnabled\");\n    return saved === null ? true : saved === \"true\";\n  });\n  const [user, setUser] = useState(() => {\n    const u = localStorage.getItem(\"user\");\n    return u ? JSON.parse(u) : null;\n  });\n\n  // Google OAuth: capture JWT from URL and store in localStorage\n\n  // On mount: check for token in URL or localStorage, fetch user info\n  useEffect(() => {\n    const params = new URLSearchParams(window.location.search);\n    let token = params.get(\"token\");\n    if (token) {\n      localStorage.setItem(\"token\", token);\n      window.history.replaceState({}, document.title, window.location.pathname);\n    } else {\n      token = localStorage.getItem(\"token\");\n    }\n    if (token && !user) {\n      fetchUserFromToken(token);\n    }\n  }, []);\n\n  async function fetchUserFromToken(token) {\n    try {\n      // Always get token from localStorage if not provided\n      if (!token) {\n        token = localStorage.getItem(\"token\");\n      }\n      console.log(\"Sending token to /auth/me:\", token);\n      if (!token) {\n        console.warn(\"No token found in localStorage. User not authenticated.\");\n        setUser(null);\n        localStorage.removeItem(\"user\");\n        localStorage.removeItem(\"token\");\n        return;\n      }\n      const res = await API.get(\"/auth/me\", {\n        headers: { Authorization: `Bearer ${token}` }\n      });\n      if (res.data && res.data.user) {\n        setUser(res.data.user);\n        localStorage.setItem(\"user\", JSON.stringify(res.data.user));\n      }\n    } catch (err) {\n      console.error(\"/auth/me 401 error. Token used:\", token, err);\n      setUser(null);\n      localStorage.removeItem(\"user\");\n      localStorage.removeItem(\"token\");\n    }\n  }\n\n  useEffect(() => {\n    if (user) fetchTweets();\n  }, [user]);\n\n\n  async function fetchTweets() {\n  const res = await API.get(\"/tweets\");\n  setTweets(res.data);\n  }\n\n  useEffect(() => {\n    if (!notificationsEnabled || !(\"Notification\" in window)) return;\n    tweets.forEach(t => {\n      if (!t._notified && t.text && /(cricket|science)/i.test(t.text)) {\n        if (Notification.permission === \"granted\") {\n          new Notification(\"New Tweet\", { body: t.text });\n          t._notified = true;\n        }\n      }\n    });\n  }, [tweets, notificationsEnabled]);\n\n  function handleAuth(u) {\n  setUser(u);\n  localStorage.setItem(\"user\", JSON.stringify(u));\n  }\n\n  function handleLogout() {\n  setUser(null);\n  localStorage.removeItem(\"user\");\n  localStorage.removeItem(\"token\");\n  }\n\n  if (!user) {\n    return <AuthForm onAuth={handleAuth} />;\n  }\n\n  return (\n    <BrowserRouter>\n      <div className=\"flex min-h-screen bg-gray-50 font-inter\">\n        <Sidebar user={user} onLogout={handleLogout} />\n        <main className=\"flex-1 flex flex-col items-center border-x border-gray-200\">\n          <Routes>\n            <Route path=\"/\" element={<Home />} />\n            <Route path=\"/explore\" element={<Explore />} />\n            <Route path=\"/notifications\" element={<Notifications />} />\n            <Route path=\"/messages\" element={<Messages />} />\n            <Route path=\"/profile\" element={<Profile />} />\n          </Routes>\n        </main>\n        <RightPanel />\n      </div>\n    </BrowserRouter>\n  );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}