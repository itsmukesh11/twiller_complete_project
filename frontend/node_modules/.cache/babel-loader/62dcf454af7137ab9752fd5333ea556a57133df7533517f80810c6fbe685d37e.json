{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import API from\"../api\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const plans=[{key:\"free\",label:\"Free (1 tweet)\",price:0,quota:1},{key:\"bronze\",label:\"Bronze (3 tweets)\",price:100,quota:3},{key:\"silver\",label:\"Silver (5 tweets)\",price:300,quota:5},{key:\"gold\",label:\"Gold (unlimited)\",price:1000,quota:Infinity}];function inISTWindow(start,end){const now=new Date();const istNow=new Date(now.toLocaleString(\"en-US\",{timeZone:\"Asia/Kolkata\"}));const h=istNow.getHours();return h>=start&&h<end;}async function fetchTodayCount(user,setTodayCount){const res=await API.get(\"/tweets\");const myId=user===null||user===void 0?void 0:user._id;if(!myId)return;const today=new Date();const istToday=new Date(today.toLocaleString(\"en-US\",{timeZone:\"Asia/Kolkata\"}));const start=new Date(istToday.getFullYear(),istToday.getMonth(),istToday.getDate(),0,0,0);const end=new Date(istToday.getFullYear(),istToday.getMonth(),istToday.getDate(),23,59,59);setTodayCount(res.data.filter(t=>{var _t$user;return((_t$user=t.user)===null||_t$user===void 0?void 0:_t$user._id)===myId&&new Date(t.createdAt)>=start&&new Date(t.createdAt)<=end;}).length);}export default function SubscriptionPage(){var _user$subscription,_plans$find;const[user,setUser]=useState(null);const[todayCount,setTodayCount]=useState(0);useEffect(()=>{async function fetchUser(){const res=await API.get(\"/auth/me\");setUser(res.data.user);}fetchUser();},[]);useEffect(()=>{if(user){fetchTodayCount(user,setTodayCount);}},[user]);async function buy(plan){if(!inISTWindow(10,11))return alert(\"Payments allowed only 10-11 AM IST\");try{const res=await API.post(\"/payments/create-checkout-session\",{plan});window.location=res.data.url;}catch(err){var _err$response,_err$response$data;alert(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message)||err.message);}}const currentPlan=(user===null||user===void 0?void 0:(_user$subscription=user.subscription)===null||_user$subscription===void 0?void 0:_user$subscription.plan)||\"free\";const quota=(_plans$find=plans.find(p=>p.key===currentPlan))===null||_plans$find===void 0?void 0:_plans$find.quota;return/*#__PURE__*/_jsxs(\"div\",{className:\"card\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Subscriptions\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-2\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Current Plan:\"}),\" \",currentPlan.charAt(0).toUpperCase()+currentPlan.slice(1),quota!==Infinity&&/*#__PURE__*/_jsxs(\"span\",{children:[\" \\u2014 \",todayCount,\"/\",quota,\" tweets today\"]}),quota===Infinity&&/*#__PURE__*/_jsx(\"span\",{children:\" \\u2014 Unlimited tweets\"})]}),plans.map(p=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-2 p-2 rounded-lg bg-white shadow-sm border border-gray-100\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:p.label}),/*#__PURE__*/_jsxs(\"span\",{className:\"ml-2 text-gray-500 font-medium\",children:[\"\\u20B9\",p.price]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[!inISTWindow(10,11)&&/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-red-500\",children:\"Payments allowed 10\\u201311 AM IST\"}),currentPlan===p.key?/*#__PURE__*/_jsx(\"div\",{className:\"px-3 py-1 rounded-full bg-gray-100 text-gray-700 font-semibold\",children:\"Active\"}):/*#__PURE__*/_jsx(\"button\",{onClick:()=>buy(p.key),disabled:!inISTWindow(10,11),className:\"px-4 py-2 rounded-full text-white font-bold shadow \".concat(inISTWindow(10,11)?\"bg-gradient-to-r from-blue-500 to-cyan-400 hover:scale-105\":\"bg-gray-300 cursor-not-allowed\"),children:\"Buy\"})]})]},p.key))]});}","map":{"version":3,"names":["React","useEffect","useState","API","jsx","_jsx","jsxs","_jsxs","plans","key","label","price","quota","Infinity","inISTWindow","start","end","now","Date","istNow","toLocaleString","timeZone","h","getHours","fetchTodayCount","user","setTodayCount","res","get","myId","_id","today","istToday","getFullYear","getMonth","getDate","data","filter","t","_t$user","createdAt","length","SubscriptionPage","_user$subscription","_plans$find","setUser","todayCount","fetchUser","buy","plan","alert","post","window","location","url","err","_err$response","_err$response$data","response","message","currentPlan","subscription","find","p","className","children","charAt","toUpperCase","slice","map","onClick","disabled","concat"],"sources":["C:/Users/itsmu/twiller_complete_project/frontend/src/components/SubscriptionPage.jsx"],"sourcesContent":["\r\nimport React, { useEffect, useState } from \"react\";\r\nimport API from \"../api\";\r\n\r\nconst plans = [\r\n  { key: \"free\", label: \"Free (1 tweet)\", price: 0, quota: 1 },\r\n  { key: \"bronze\", label: \"Bronze (3 tweets)\", price: 100, quota: 3 },\r\n  { key: \"silver\", label: \"Silver (5 tweets)\", price: 300, quota: 5 },\r\n  { key: \"gold\", label: \"Gold (unlimited)\", price: 1000, quota: Infinity }\r\n];\r\n\r\nfunction inISTWindow(start, end) {\r\n  const now = new Date();\r\n  const istNow = new Date(now.toLocaleString(\"en-US\", { timeZone: \"Asia/Kolkata\" }));\r\n  const h = istNow.getHours();\r\n  return h >= start && h < end;\r\n}\r\n\r\nasync function fetchTodayCount(user, setTodayCount) {\r\n  const res = await API.get(\"/tweets\");\r\n  const myId = user?._id;\r\n  if (!myId) return;\r\n  const today = new Date();\r\n  const istToday = new Date(today.toLocaleString(\"en-US\", { timeZone: \"Asia/Kolkata\" }));\r\n  const start = new Date(istToday.getFullYear(), istToday.getMonth(), istToday.getDate(), 0, 0, 0);\r\n  const end = new Date(istToday.getFullYear(), istToday.getMonth(), istToday.getDate(), 23, 59, 59);\r\n  setTodayCount(res.data.filter(t => t.user?._id === myId && new Date(t.createdAt) >= start && new Date(t.createdAt) <= end).length);\r\n}\r\n\r\nexport default function SubscriptionPage() {\r\n  const [user, setUser] = useState(null);\r\n  const [todayCount, setTodayCount] = useState(0);\r\n\r\n  useEffect(() => {\r\n    async function fetchUser() {\r\n      const res = await API.get(\"/auth/me\");\r\n      setUser(res.data.user);\r\n    }\r\n    fetchUser();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (user) {\r\n      fetchTodayCount(user, setTodayCount);\r\n    }\r\n  }, [user]);\r\n\r\n  async function buy(plan) {\r\n    if (!inISTWindow(10, 11)) return alert(\"Payments allowed only 10-11 AM IST\");\r\n    try {\r\n      const res = await API.post(\"/payments/create-checkout-session\", { plan });\r\n      window.location = res.data.url;\r\n    } catch (err) {\r\n      alert(err.response?.data?.message || err.message);\r\n    }\r\n  }\r\n\r\n  const currentPlan = user?.subscription?.plan || \"free\";\r\n  const quota = plans.find(p => p.key === currentPlan)?.quota;\r\n\r\n  return (\r\n    <div className=\"card\">\r\n      <h4>Subscriptions</h4>\r\n      <div className=\"mb-2\">\r\n        <strong>Current Plan:</strong> {currentPlan.charAt(0).toUpperCase() + currentPlan.slice(1)}\r\n        {quota !== Infinity && (\r\n          <span> &mdash; {todayCount}/{quota} tweets today</span>\r\n        )}\r\n        {quota === Infinity && (\r\n          <span> &mdash; Unlimited tweets</span>\r\n        )}\r\n      </div>\r\n      {plans.map(p => (\r\n        <div key={p.key} className=\"flex items-center justify-between mb-2 p-2 rounded-lg bg-white shadow-sm border border-gray-100\">\r\n          <div>\r\n            <strong>{p.label}</strong>\r\n            <span className=\"ml-2 text-gray-500 font-medium\">₹{p.price}</span>\r\n          </div>\r\n          <div className=\"flex items-center gap-2\">\r\n            {!inISTWindow(10,11) && <div className=\"text-xs text-red-500\">Payments allowed 10–11 AM IST</div>}\r\n            {currentPlan === p.key ? (\r\n              <div className=\"px-3 py-1 rounded-full bg-gray-100 text-gray-700 font-semibold\">Active</div>\r\n            ) : (\r\n              <button\r\n                onClick={() => buy(p.key)}\r\n                disabled={!inISTWindow(10,11)}\r\n                className={`px-4 py-2 rounded-full text-white font-bold shadow ${inISTWindow(10,11) ? \"bg-gradient-to-r from-blue-500 to-cyan-400 hover:scale-105\" : \"bg-gray-300 cursor-not-allowed\"}`}\r\n              >Buy</button>\r\n            )}\r\n          </div>\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}